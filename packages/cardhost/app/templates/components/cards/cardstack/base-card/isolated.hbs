{{!-- TODO move this into the @cardstack/base-card package when we support runtime js compilation --}}
<div
  class="isolated-card cardstack_base-card-isolated {{safe-css-string @card.name}}-isolated {{safe-css-string @card.adoptedFromName}}-isolated"
  data-test-isolated-card={{@card.name}}
  data-test-isolated-card-mode={{@mode}}
>
  <AnimatedContainer class={{if (or (eq @mode "view") (eq @mode "layout")) "isolated-card--view-fields"}}>
    <MaybeAnimate
      @mode={{@mode}}
      @animationMode="schema"
      @component="animated-each"
      @content={{@fields}}
      @key="nonce"
      @use={{this.transition}}
      @duration={{this.duration}} as |field|>
      {{#if @setFieldValue}}
        <FieldRenderer
          @field={{field}}
          @mode={{@mode}}
          @setFieldValue={{fn @setFieldValue field.name}}
          @selectField={{@selectField}}
          @selectedField={{@selectedField}}
        />
      {{else if (or @setNeededWhenEmbedded @setPosition @removeField @setFieldName)}}
        <FieldRenderer
          @field={{field}}
          @mode={{@mode}}
          @dropField={{@dropField}}
          @removeField={{@removeField}}
          @toggleStubField={{@toggleStubField}}
          @setPosition={{@setPosition}}
          @setNeededWhenEmbedded={{@setNeededWhenEmbedded}}
          @setFieldName={{@setFieldName}}
          @selectField={{@selectField}}
          @selectedField={{@selectedField}}
        />
        {{#if (and (eq @mode "schema") @dropField (not field.preview))}}
          <DropZone @dropField={{@dropField}} @position={{inc field.position}} @toggleStubField={{@toggleStubField}} />
        {{/if}}
      {{else}}
        <FieldRenderer @field={{field}} @mode={{@mode}}/>
      {{/if}}
    </MaybeAnimate>
  </AnimatedContainer>
</div>
{{page-title "Card Pay" replace=true}}

<Boxel::Dashboard @darkTheme={{true}} class="card-pay" data-test-card-pay>
  <:header>
    <CardPay::Header
      @title="Card Pay"
      @logoURL={{this.cardPayLogo}}
      @layer1ChainName={{network-display-info "layer1" "fullName"}}
      @layer1Connect={{set this 'isShowingLayer1ConnectModal' true}}
      @layer2ChainName={{network-display-info "layer2" "fullName"}}
      @layer2Connect={{set this 'isShowingLayer2ConnectModal' true}}
      @isLayer1Connected={{this.layer1Network.isConnected}}
      @isLayer2Connected={{this.layer2Network.isConnected}}
      @layer1Address={{this.layer1Network.walletInfo.firstAddress}}
      @layer2Address={{this.layer2Network.walletInfo.firstAddress}}
    />
    <CardPay::HeaderNav
      @tabs={{array
        (hash title="Card Balances" route="card-pay.balances" icon="tab-icon-card")
        (hash title="Merchant Services" route="card-pay.merchant-services" icon="tab-icon-merchant")
        (hash title="Token Suppliers" route="card-pay.token-suppliers" icon="tab-icon-token")
        (hash title="Reward Programs" route="card-pay.reward-programs" icon="tab-icon-rewards" inactive=true)
      }}
    />
  </:header>

  <:body>
    <section class="card-pay-dashboard__body">
      {{#if this.layer2Network.isConnected}}
        <Boxel::Sidebar class="card-pay-dashboard__sidebar" data-test-wallet-sidebar as |SidebarSection|>
          <SidebarSection>
            My Account: {{truncate-middle this.layer2Network.walletInfo.firstAddress}}
          </SidebarSection>

          {{#if this.layer2Network.prepaidCards}}
            <SidebarSection>
              <h4 class="card-pay-dashboard__sidebar-section-header">
                {{svg-jar "tab-icon-card" class="card-pay-dashboard__sidebar-section-icon" width="18" height="18" role="presentation"}}
                Card Balances
              </h4>
              <LinkTo class="card-pay-dashboard__sidebar-link" @route="card-pay.balances">
                {{svg-jar "active-sidebar-link-triangle" class="card-pay-dashboard__sidebar-link-icon" width="15" height="15" role="presentation"}}
                <div>
                  <div class="card-pay-dashboard__sidebar-link-header">
                    Prepaid Cards
                  </div>
                  {{pluralize this.layer2Network.prepaidCards.length "Card"}}
                </div>
              </LinkTo>
            </SidebarSection>
          {{/if}}
        </Boxel::Sidebar>
      {{/if}}

      {{outlet}}
    </section>
  </:body>
</Boxel::Dashboard>

<CardPay::LayerConnectModal
  @name="layer1"
  @isOpen={{this.isShowingLayer1ConnectModal}}
  @onClose={{set this 'isShowingLayer1ConnectModal' false}}
  @isLayerConnected={{this.layer1Network.isConnected}}
/>

<CardPay::LayerConnectModal
  @name="layer2"
  @isOpen={{this.isShowingLayer2ConnectModal}}
  @onClose={{set this 'isShowingLayer2ConnectModal' false}}
  @isLayerConnected={{this.layer2Network.isConnected}}
/>

{{#if this.chainChangeModalOptions}}
  <CardPay::ChainChangeModal
    @isOpen={{true}}
    @title={{this.chainChangeModalOptions.title}}
    @body={{this.chainChangeModalOptions.body}}
    @actionText={{this.chainChangeModalOptions.actionText}}
    @action={{this.chainChangeModalOptions.action}}
    @onClose={{this.chainChangeModalOptions.onClose}}
    @dismissable={{this.chainChangeModalOptions.dismissable}}
  />
{{/if}}
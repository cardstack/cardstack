{{page-title "Token Suppliers"}}

<section class="card-pay-dashboard__token-suppliers" role="tabpanel" aria-labelledby="card-pay.token-suppliers">
  <CardPay::DashboardPanel @panel={{@model.panel}} @noCollapse={{not this.layer2Network.isConnected}}>
    {{#each @model.panel.sections as |section|}}
      <CardPay::DashboardPanel::Section @section={{section}}>
        <:cta>
          <Boxel::Button
            {{on "click" (fn this.transitionToTokenSuppliers section.workflow)}}

            @kind="primary"
            @size="touch"
            @disabled={{section.isCtaDisabled}}
            data-test-workflow-button={{section.workflow}}
          >
            {{section.cta}}
          </Boxel::Button>
        </:cta>
      </CardPay::DashboardPanel::Section>
    {{/each}}
  </CardPay::DashboardPanel>

  {{#if this.layer2Network.isConnected}}
    <section data-test-suppliers-section>
      <h2 class="card-pay-dashboard__suppliers-title">Token Suppliers</h2>
      {{#if this.layer2Network.depotSafe}}
        <section class="card-pay-dashboard__depot">
          <header class="card-pay-dashboard__depot-header">
            <div class="card-pay-dashboard__depot-network">
              On {{network-display-info "layer2" "fullName"}}
            </div>
            <div class="card-pay-dashboard__depot-address">
              {{truncate-middle this.layer2Network.depotSafe.address}}
            </div>
          </header>
          <section class="card-pay-dashboard__depot-body">
            <h3 class="card-pay-dashboard__depot-title">Depot</h3>
            <h4 class="card-pay-dashboard__depot-balances-title">
              <div>
                Layer 2 Balances
                <span class="card-pay-dashboard__depot-balances-num">{{this.tokens.length}}</span>
              </div>
              <div class="card-pay-dashboard__depot-balances-num">
                {{format-usd this.usdBalanceTotal}}
              </div>
            </h4>
            <div class="card-pay-dashboard__depot-balances-grid">
              {{#each this.tokensWithDisplayInfo as |t|}}
                <div class="card-pay-dashboard__token">
                  <CardPay::BalanceDisplay
                    class="card-pay-dashboard__token-balance-display"
                    @icon={{t.icon}}
                    @balance={{format-wei-amount t.balance}}
                    @symbol={{t.symbol}}
                    @usdBalance={{token-to-usd t.symbol t.balance}}
                  />
                </div>
              {{/each}}
            </div>
          </section>
        </section>
      {{else}}
        N/A
      {{/if}}
    </section>
  {{/if}}
</section>

<Boxel::Modal
  style={{css-var boxel-modal-max-width="65rem"}} {{!-- ~1040px --}}
  @isOpen={{or (eq this.flow 'deposit') (eq this.flow 'withdrawal')}}
  @onClose={{this.resetQueryParams}}
>
  {{#if (is-network-initialized)}}
    {{#if (eq this.flow 'deposit')}}
      <CardPay::DepositWorkflow />
    {{/if}}
    {{#if (eq this.flow 'withdrawal')}}
      <CardPay::WithdrawalWorkflow />
    {{/if}}
  {{/if}}
</Boxel::Modal>

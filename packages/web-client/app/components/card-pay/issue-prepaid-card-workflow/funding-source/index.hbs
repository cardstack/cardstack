<ActionCardContainer
  @header="Prepaid card funding"
  @isComplete={{@isComplete}}
>
  <ActionCardContainer::Section>
    <ActionCardContainer::Section @title="Choose a depot and balance to fund your prepaid card">
      <CardPay::NestedAccountDepotDisplay
        @accountAddress={{this.layer2Network.walletInfo.firstAddress}}
        @depotAddress={{this.depotAddress}}
        @size={{if @isComplete "large"}}
      />
    </ActionCardContainer::Section>
    {{#if this.depotAddress}}
      <ActionCardContainer::Section>
        <CardPay::LabeledValue @label="Balance:" class="funding-source__field">
          <CardPay::NestedItems
            @noBorder={{not @isComplete}}
            @noIndent={{not @isComplete}}
            class="funding-source__nested-items"
          >
            <:outer>
              <CardPay::AccountDisplay
                @size={{if @isComplete "small"}}
                @icon="depot"
                @name="DEPOT:"
                @address={{if @isComplete (truncate-middle this.depotAddress) this.depotAddress}}
                data-test-account-depot-outer
              />
            </:outer>
            <:inner>
              {{#if @isComplete}}
                <CardPay::BalanceDisplay
                  @size="large"
                  @icon={{this.selectedToken.icon}}
                  @balance={{format-token-amount this.selectedToken.balance}}
                  @symbol={{this.selectedTokenSymbol}}
                  data-test-account-balance
                />
              {{else}}
                <div class="funding-source__dropdown-container">
                  <CardPay::BalanceChooserDropdown
                    @tokens={{this.tokens}}
                    @selectedToken={{this.selectedToken}}
                    @selectedTokenSymbol={{this.selectedTokenSymbol}}
                    @chooseToken={{this.chooseSource}}
                  />
                </div>
              {{/if}}
            </:inner>
          </CardPay::NestedItems>
        </CardPay::LabeledValue>
      </ActionCardContainer::Section>
    {{/if}}
  </ActionCardContainer::Section>
  <Boxel::ActionChin
    @state={{if @isComplete "memorialized" "default"}}
    @disabled={{or @frozen this.isDisabled}}
  >
    <:default as |d|>
      <d.ActionButton {{on "click" this.save}}>
        Continue
      </d.ActionButton>
    </:default>
    <:memorialized as |m|>
      <m.ActionButton {{on "click" @onIncomplete}}>
        Edit
      </m.ActionButton>
    </:memorialized>
  </Boxel::ActionChin>
</ActionCardContainer>
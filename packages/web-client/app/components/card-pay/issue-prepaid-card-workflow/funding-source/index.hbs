<ActionCardContainer
  @header="Prepaid card funding"
  @isComplete={{@isComplete}}
>
  <ActionCardContainer::Section>
    <ActionCardContainer::Section @title="Choose a balance to fund your prepaid card">
      <CardPay::LabeledValue @label="DEPOT:" class="funding-source__field">
        <CardPay::NestedItems class="funding-source__field-info">
          <:outer>
            {{!-- TODO: display account avatar and name if available --}}
            <CardPay::AccountDisplay
              @size="small"
              @icon="avatar-default"
              @name="Account 1"
              @address={{truncate-middle this.layer2Network.walletInfo.firstAddress}}
              data-test-funding-source-account
            />
          </:outer>
          <:inner>
            <CardPay::AccountDisplay
              @size={{if @isComplete "large"}}
              @icon="depot"
              @name="DEPOT:"
              @address={{this.depotAddress}}
              data-test-funding-source-depot-inner
            />
          </:inner>
        </CardPay::NestedItems>
      </CardPay::LabeledValue>
    </ActionCardContainer::Section>
    <ActionCardContainer::Section>
      <CardPay::LabeledValue @label="BALANCE:" class="funding-source__field">
        <CardPay::NestedItems
          class="funding-source__field-info"
          @noBorder={{not @isComplete}}
          @noIndent={{not @isComplete}}
        >
          <:outer>
            <CardPay::AccountDisplay
              @size={{if @isComplete "small"}}
              @icon="depot"
              @name="DEPOT:"
              @address={{if @isComplete (truncate-middle this.depotAddress) this.depotAddress}}
              data-test-funding-source-depot-outer
            />
          </:outer>
          <:inner>
            {{#if @isComplete}}
              <CardPay::BalanceDisplay
                @size="large"
                @icon={{this.selectedToken.icon}}
                @balance={{this.selectedToken.balance}}
                @symbol={{this.selectedToken.symbol}}
                data-test-funding-source-token
              />
            {{else}}
              <div class="funding-source__nested-dropdown">
                <PowerSelect
                  class="funding-source__dropdown"
                  @options={{this.tokens}}
                  @selected={{this.selectedToken}}
                  @onChange={{this.chooseSource}}
                  @renderInPlace={{true}}
                  @verticalPosition="below"
                  data-test-funding-source-dropdown={{this.selectedToken.symbol}}
                as |token|>
                  <CardPay::BalanceDisplay
                    class={{cn "funding-source__dropdown-option" (if (eq token.symbol this.selectedToken.symbol) "funding-source__dropdown-option--selected")}}
                    @size="small"
                    @icon={{token.icon}}
                    @title={{token.symbol}}
                    @balance={{token.balance}}
                    @symbol={{token.symbol}}
                    data-test-funding-source-token-option={{token.symbol}}
                  />
                </PowerSelect>
              </div>
            {{/if}}
          </:inner>
        </CardPay::NestedItems>
      </CardPay::LabeledValue>
    </ActionCardContainer::Section>
  </ActionCardContainer::Section>
  <Boxel::ActionChin
    @state={{if @isComplete "memorialized" "default"}}
    @disabled={{@frozen}}
  >
    <:default as |d|>
      <d.ActionButton {{on "click" @onComplete}}>
        Continue
      </d.ActionButton>
    </:default>
    <:memorialized as |m|>
      <m.ActionButton {{on "click" @onIncomplete}}>
        Edit
      </m.ActionButton>
    </:memorialized>
  </Boxel::ActionChin>
</ActionCardContainer>
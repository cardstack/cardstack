<ActionCardContainer
  @header="Deposit"
  @isComplete={{@isComplete}}
  data-test-deposit-transaction-setup-is-complete={{@isComplete}}
>
  <ActionCardContainer::Section>
    <ActionCardContainer::Section @title="Deposit tokens">
      <CardPay::LabeledValue @label="From:" class="transaction-setup__field">
        {{#if @isComplete}}
          <CardPay::NestedItems>
            <:outer>
              <div class="transaction-setup__title">{{this.layer1Network.chainName}} wallet</div>
              <div class="transaction-setup__address" data-test-deposit-transaction-setup-from-address>{{this.layer1Network.walletInfo.firstAddress}}</div>
            </:outer>
            <:inner>
              <div class="transaction-setup__icon-group" data-test-option-view-only>
                {{svg-jar this.selectedToken.icon class="transaction-setup__icon" role="presentation" width="40" height="40"}}
                <div>
                  <div class={{if @isComplete "transaction-setup__title-lg" "transaction-setup__title"}} data-test-balance-view-only={{this.selectedToken.symbol}}>
                    {{format-token-amount this.selectedTokenBalance}} {{uppercase this.selectedToken.symbol}}
                  </div>
                  <div class="transaction-setup__text-sm" data-test-usd-balance-view-only={{this.selectedToken.symbol}}>
                    â‰ˆ $ {{token-to-usd this.selectedToken.symbol this.selectedTokenBalance}} USD
                  </div>
                </div>
              </div>
            </:inner>
          </CardPay::NestedItems>
        {{else}}
          <div>
            <div class="transaction-setup__title">{{this.layer1Network.chainName}} wallet</div>
            <div class="transaction-setup__address" data-test-deposit-transaction-setup-from-address>{{this.layer1Network.walletInfo.firstAddress}}</div>
          </div>
          <div class="transaction-setup__field-info transaction-setup__radio-buttons">
            {{#each this.tokens as |token|}}
              {{#let (if (eq token.symbol 'CARD') this.layer1Network.cardBalance this.layer1Network.daiBalance) as |balance|}}
                <CardPay::DepositWorkflow::TransactionSetup::TokenOption
                  @checked={{eq @workflowSession.state.depositSourceToken token.symbol}}
                  @onInput={{fn this.chooseSource token.symbol}}
                  @balance={{format-token-amount balance}}
                  @balanceInUsd={{token-to-usd token.symbol balance}}
                  @tokenSymbol={{token.symbol}}
                  @tokenDescription={{token.description}}
                  @tokenIcon={{token.icon}}
                />
              {{/let}}
            {{/each}}
          </div>
        {{/if}}
      </CardPay::LabeledValue>
    </ActionCardContainer::Section>
    <ActionCardContainer::Section @title="Receive tokens">
      <CardPay::LabeledValue @label="In:" class="transaction-setup__field">
        <div class="transaction-setup__title">{{this.layer2Network.chainName}} wallet</div>
          <CardPay::NestedItems class="transaction-setup__field-info">
            <:outer>
              <div class="transaction-setup__icon-group-sm">
                {{svg-jar "avatar-default" width="20" height="20" class="transaction-setup__icon-sm" role="presentation"}}
                <div>
                  <div class="transaction-setup__title-sm">Account 1</div>
                  <div class="transaction-setup__address-sm" data-test-deposit-transaction-setup-to-address>
                    {{truncate-middle this.layer2Network.walletInfo.firstAddress 7 4}}
                  </div>
                </div>
              </div>
            </:outer>
            <:inner>
              <div class="transaction-setup__icon-group">
                {{svg-jar "depot" width="40" height="40" class="transaction-setup__icon" role="presentation"}}
                <div>
                  <div class={{if @isComplete "transaction-setup__title-lg" "transaction-setup__title"}}>DEPOT:</div>
                  {{#if this.fetchDepotTask.last.isSuccessful}}
                    {{#if this.fetchDepotTask.last.value.address}}
                      <div class={{cn "transaction-setup__address" transaction-setup__address--wrapped=@isComplete}} data-test-deposit-transaction-setup-depot-address>
                        {{this.fetchDepotTask.last.value.address}}
                      </div>
                    {{else}}
                      <div class="transaction-setup__text-sm" data-test-deposit-transaction-setup-depot-address>
                        New Depot
                      </div>
                    {{/if}}
                  {{else}}
                    <Boxel::LoadingIndicator/>
                  {{/if}}
                </div>
              </div>
            </:inner>
          </CardPay::NestedItems>
      </CardPay::LabeledValue>
    </ActionCardContainer::Section>
  </ActionCardContainer::Section>
  <Boxel::ActionChin
    @state={{if @isComplete "memorialized" "default"}}
    @disabled={{or @frozen (not @workflowSession.state.depositSourceToken)}}
    data-test-deposit-transaction-setup
  >
    <:default as |d|>
      <d.ActionButton
        {{on "click" this.toggleComplete}}
      >
        Continue
      </d.ActionButton>
    </:default>
    <:memorialized as |m|>
      <m.ActionButton {{on "click" this.toggleComplete}}>
        Edit
      </m.ActionButton>
    </:memorialized>
  </Boxel::ActionChin>
</ActionCardContainer>
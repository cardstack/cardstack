{{! eslint is confused about indentation for else-if }}
{{! template-lint-disable block-indentation}}

{{this.onFieldUpdated}}

{{#if (and (eq @mode "schema") @dropField)}}
  <DropZone @dropField={{@dropField}} @position={{@field.position}} />
{{/if}}

{{!-- TODO: let's think of a more accessible solution here, consider making this a button--}}
{{!-- TODO: also we should also turn on a11y linting --}}
<div {{on "click" (fn this.selectField @field)}}
  class={{concat
    "field-renderer "
    @mode
    "-field "
    "field-"
    @field.name
    " field-type-"
    this.dasherizedType
  }}
  {{on "dragstart" (action this.startDragging @field)}}
  {{on "dragend" (action this.finishDragging)}}
  data-test-field={{@field.name}}
  data-test-field-type={{@field.type}}
  data-test-field-mode={{@mode}}
>
  {{#if @setPosition}}
    <button
      class="field-renderer--move-btn"
      aria-label="Drag field"
      {{on "mousedown" (action this.initDrag @field)}}
      {{on "mouseup" (action this.endDrag)}}
      {{on "dragend" (action (mut this.isDragging) false)}}
      data-test-field-renderer-move-btn
      data-test-field-renderer-move-btn-position={{@field.position}}
    >
    </button>
  {{/if}}

  {{#if (eq @mode "view")}}
    {{#let (component this.fieldViewer) as | FieldViewer |}}
      <FieldViewer @field={{@field}}/>
    {{/let}}
  {{else if (eq @mode "edit")}}
    {{#let (component this.fieldEditor) as | FieldEditor |}}
      <div class="edit-field-renderer">
        <FieldEditor
          @field={{@field}}
          @setFieldValue={{@setFieldValue}}
        />
      </div>
    {{/let}}
  {{else if (and (eq @mode "schema") @isRightEdgeField)}}
    {{!-- TODO we should extract the schema editing stuff into a seaprate component --}}
    <div class="schema-field-renderer">
      {{#if (includes schemaAttrs "title")}}
        <header
          class="schema-field-renderer--header"
          data-test-field-renderer-header
        >
          {{@field.name}}
        </header>
      {{/if}}
      <div class="schema-field-renderer--attributes">
        {{#each this.schemaAttrs as |schemaAttr|}}
          {{#if (eq schemaAttr "type")}}
            <div
              class="schema-field-renderer--attribute"
              data-test-schema-attr={{schemaAttr}}
            >
              <span class="schema-field-renderer--attribute-name">Field Type</span>
              <span
                class="schema-field-renderer--attribute-value"
                data-test-field-renderer-field-type
              >
                {{@field.type}}
              </span>
            </div>
          {{else if (eq schemaAttr "label")}}
            <div
              class="schema-field-renderer--attribute"
              data-test-schema-attr={{schemaAttr}}
            >
              {{#if @setFieldLabel}}
                <label
                  for={{concat "edit-field-label-" @field.nonce "-" this.renderNonce}}
                  class="schema-field-renderer--attribute-name"
                  data-test-field-renderer-field-label-label
                >
                  Field Label
                </label>
                <Input
                  @id={{concat "edit-field-label-" @field.nonce "-" this.renderNonce}}
                  @class="field-renderer-field-label-input schema-field-renderer--input"
                  @value={{this.newFieldLabel}}
                  @key-up={{action this.updateFieldLabel}}
                />
              {{else}}
                <span class="schema-field-renderer--attribute-name">Field Label</span>
                <span
                  class="schema-field-renderer--attribute-value"
                  data-test-field-renderer-field-label
                >
                  {{@field.label}}
                </span>
              {{/if}}
            </div>
          {{else if (eq schemaAttr "instructions")}}
            <div
              class="schema-field-renderer--attribute"
              data-test-schema-attr={{schemaAttr}}
            >
              {{#if @setFieldInstructions}}
                <label
                  for={{concat "edit-field-instructions-" @field.nonce "-" this.renderNonce}}
                  class="schema-field-renderer--attribute-name"
                  data-test-field-renderer-field-instructions-label
                >
                  Helper Text
                </label>
                <Textarea
                  @id={{concat "edit-field-instructions-" @field.nonce "-" this.renderNonce}}
                  @class="field-renderer-field-instructions-input schema-field-renderer--input"
                  @value={{this.newFieldInstructions}}
                  @key-up={{action this.updateFieldInstructions}}
                />
              {{else}}
                <span class="schema-field-renderer--attribute-name">Helper Text</span>
                <span
                  class="schema-field-renderer--attribute-value"
                  data-test-field-renderer-field-instructions
                >
                  {{@field.instructions}}
                </span>
              {{/if}}
            </div>
          {{else if (eq schemaAttr "is-meta")}}
            <div
              class="schema-field-renderer--attribute"
              data-test-schema-attr={{schemaAttr}}
            >
              <span class="schema-field-renderer--attribute-name">Is Metadata Field</span>
              <span data-test-field-renderer-is-meta>
                {{if @field.json.data.attributes.is-metadata "true" "false"}}
              </span>
            </div>
          {{else if (and (eq schemaAttr "name") @setFieldName)}}
            <div
              class="schema-field-renderer--attribute"
              data-test-schema-attr={{schemaAttr}}
            >
              <label
                for={{concat "edit-field-name-" @field.nonce "-" this.renderNonce}}
                class="schema-field-renderer--attribute-name"
                data-test-field-renderer-field-name-label
              >
                Field Name
              </label>
              <Input
                @id={{concat "edit-field-name-" @field.nonce "-" this.renderNonce}}
                @class="field-renderer-field-name-input schema-field-renderer--input"
                @value={{this.newFieldName}}
                @key-up={{action this.updateFieldName}}
              />
            </div>
          {{else if (eq schemaAttr "embedded")}}
            <div
              class="schema-field-renderer--attribute"
              data-test-schema-attr={{schemaAttr}}
            >
              {{#if @setNeededWhenEmbedded}}
                <label for="new_field_embedded" class="checkbox-container">
                  Available When Embedded
                  <Input
                    @checked={{@field.neededWhenEmbedded}}
                    @class="field-renderer--needed-when-embedded-chbx"
                    @type="checkbox"
                    @id={{concat "edit_" @field.name "_" this.renderNonce "_embedded"}}
                    @click={{fn @setNeededWhenEmbedded @field.name}}
                  />
                  <span class="checkmark"></span>
                </label>
              {{else}}
                <span class="schema-field-renderer--attribute-name">Available When Embedded</span>
                <span
                  class="schema-field-renderer--attribute-value"
                  data-test-field-renderer-embedded
                >
                  {{if @field.neededWhenEmbedded "true" "false"}}
                </span>
              {{/if}}
            </div>
          {{else if
            (and
              (eq schemaAttr "multiselect")
              (or
                (eq @field.type "@cardstack/core-types::belongs-to")
                (eq @field.type "@cardstack/core-types::has-many")
              )
            )
          }}
            <div
              class="schema-field-renderer--attribute"
              data-test-schema-attr={{schemaAttr}}
            >
              <label class="checkbox-container">
                Multiselect
                <Input @type="checkbox" />
                <span class="checkmark"></span>
              </label>
            </div>
          {{else if (eq schemaAttr "required")}}
            <div
              class="schema-field-renderer--attribute"
              data-test-schema-attr={{schemaAttr}}
            >
              <label class="checkbox-container">
                Required
                <Input @type="checkbox" />
                <span class="checkmark"></span>
              </label>
            </div>
          {{/if}}
        {{/each}}
      </div>
    </div>
  {{else if (eq @mode "schema")}}
    <div class="schema-field-renderer" tabindex="0">
      {{! template-lint-disable no-inline-styles}}
      {{!-- TODO: need to display field icon and (formatted) type --}}
      <header
        class="schema-field-renderer--header-bar"
        data-test-field-renderer-type
      >
        {{@field.type}}
      </header>
      <div class="schema-field-renderer--content">
        <div
          class="schema-field-renderer--name"
          data-test-field-renderer-label
        >
          {{@field.label}}
        </div>
        <div class="schema-field-renderer--value" data-test-field-renderer-value>
          {{@field.value}}
        </div>
      </div>
    </div>
  {{/if}}

  {{#if @removeField}}
    <button {{on "click" (fn @removeField @field.name)}}
      class="field-renderer--remove-btn"
      aria-label="Remove"
      data-test-field-renderer-remove-btn
    >
    </button>
  {{/if}}
</div>
<section class="cardstack-message-summary">
  <div class="cardstack-workflow-group">
    <h4 class="cardstack-workflow-group-header">Dashboards</h4>
    <div class={{concat "cardstack-workflow-label-with-count-wrapper " (if (eq selectedDate 'today') "active")}}>
      <div class="cardstack-workflow-label-with-count high-priority" onclick={{action 'selectDate' 'today'}}>
        <div class="name">Today</div>
        {{#if todaysNotificationCount}}
          <div class="count" data-test-group-counter="Today">{{todaysNotificationCount}}</div>
        {{/if}}
      </div>
    </div>
  </div>

  {{#each-in groupedThreads as |priorityId priorityGroup|}}
    {{#with priorityGroup.name as |priority|}}
      <div class="cardstack-workflow-group" data-test-workflow-group={{priority}}>
        <h4 class="cardstack-workflow-group-header" data-test-priority-header={{priority}}>{{priority}}</h4>
        {{#each-in priorityGroup.tagGroups as |tagId tagGroup|}}
          {{#with (workflow-group-id priority tagGroup.name) as |groupId|}}
            <div class={{concat "cardstack-workflow-label-with-count-wrapper " (if (eq selectedGroup groupId) "active")}}>
              <div class={{concat "cardstack-workflow-label-with-count " tagGroup.priorityLevel "-priority"}}
                   onclick={{action 'selectTag' (hash priority=priority tagId=tagId)}}>
                <div class='name'>{{tagGroup.name}}</div>
                {{#if tagGroup.unhandled.length}}
                  <div class="count" data-test-group-counter={{groupId}}>{{tagGroup.unhandled.length}}</div>
                {{/if}}
              </div>
            </div>
          {{/with}}
        {{/each-in}}
      </div>
    {{/with}}
  {{/each-in}}
</section>

{{#if selectedThread}}
  <section class="cardstack-thread-view">
    {{cardstack/thread-container thread=selectedThread}}
  </section>
{{else}}
  {{#if shouldShowMatchingThreads}}
    <section class="cardstack-cue-card-list">
      {{#each-in matchingThreads as |priorityId priorityGroup|}}
        {{#with priorityGroup.name as |name|}}
          <h4 class="cardstack-workflow-group-header" data-test-priority-header={{name}}>{{name}}</h4>
          {{#each priorityGroup.threads as |thread|}}
            {{cardstack/thread-list-card thread=thread onSelect=(action "selectThread" thread)}}
          {{/each}}
        {{/with}}
      {{else}}
        <div class="cardstack-empty-cue-card-message" data-test-empty-group-message>
          There are no cards to show.
        </div>
      {{/each-in}}
    </section>
  {{/if}}
{{/if}}
{{cardstack-workflow-launcher onClick=(action "toggleOpen")}}

{{#if isOpen}}
  <div class="cardstack-workflow-rail-wrapper">
    <section class="cardstack-message-summary">
      <div class="cardstack-workflow-group today">
        <h4 class="cardstack-workflow-group-header">
          Dashboards
        </h4>
        <div 
          class={{concat
            "cardstack-workflow-label-with-count-wrapper "
            (if (eq selectedDate "today") "active")
          }}
        >
          <span 
            class="cardstack-workflow-label-with-count high-priority"
            role="button"
            onclick={{action "selectDate" "today"}}
          >
            <span class="name">
              Today
            </span>
            {{#if todaysNotificationCount}}
              <span
                class="count"
                data-test-group-counter="Today"
              >
                {{todaysNotificationCount}}
              </span>
            {{/if}}
          </span>
        </div>
      </div>

      {{#each-in groupedThreads as |priorityId priorityGroup|}}
        {{#with priorityGroup.name as |priority|}}
          <div class="cardstack-workflow-group" data-test-workflow-group={{priority}}>
            <h4
              class="cardstack-workflow-group-header"
              data-test-priority-header={{priority}}
            >
              {{priority}}
            </h4>
            {{cardstack/priority-tag-groups
              groups=priorityGroup.tagGroups
              selectedGroup=selectedGroup
              priority=priority
              onSelect=(action "selectTag")
            }}
          </div>
        {{/with}}
      {{/each-in}}
    </section>

    {{#if selectedThread}}
      <section class="cardstack-thread-view">
        {{cardstack/thread-container thread=selectedThread}}
      </section>
    {{else}}
      {{#if shouldShowMatchingThreads}}
        <section class="cardstack-cue-card-list">
          {{cardstack/thread-list
            threads=matchingThreads
            onSelect=(action "selectThread")
          }}
        </section>
      {{/if}}
    {{/if}}
  </div>
{{/if}}
